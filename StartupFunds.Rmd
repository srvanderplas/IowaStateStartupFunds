---
title: "Startup Funds Investigation"
author: "Susan VanderPlas"
date: "June 10, 2015"
output: 
  knitrBootstrap:::bootstrap_document:
    theme: cerulean
    highlight: idea
    menu: FALSE
    clean_supporting: TRUE
---


```{r setup, echo=FALSE}
library(knitr)
library(htmltools)
library(ggplot2)
library(scales)
# s0 <- knitr::knit_hooks$get('source')
# knitr::knit_hooks$set(
#   list(
#     source=function(x,options){
#       if(is.null(options$class)) s0(x, options)
#       else
#         tags$button(class=c())
#     }
#   )
# )
# 
knitr::opts_chunk$set(bootstrap.show.code=FALSE, bootstrap.show.output=FALSE, bootstrap.show.message=FALSE, warning=F, message=F, out.width="100%", cache=T, echo=F, dpi=300)
knitr::opts_knit$set(root.dir="../../IowaStateStartupFunds/")

# Transformation - log(x+1) to deal with zero data 
log_one_trans <- function() trans_new("log_one", function(x) log10(x+1), function(x) 10^x-1, domain=c(0, Inf))
```

# Introduction

The following information was taken from meeting notes (meetings on 6/4/2015 and 5/20/2015)

## Goals for the project:

1. Examine trends (or lack thereof) in startup funding over time
2. Examine return on investment for startup funding 
    - Publications
    - Proposals submitted
    - Grants received
    - Tenure

## Data: 

1. Spreadsheets from the Office of the Vice President for Research
    - Name, Department, College, Salary, Start Date
    - Startup package allocation (by category) 
    - Source of startup funding
2. Database from Office of Sponsored Programs Administration (2 databases, 2005-2010 and 2010-2015. Early database will be messier)
    - Grants received (by month, as well as total award $$)
    - Proposals submitted
3. Additional information 
    - Publications (from scraping Google Scholar)
    - Where individuals came from (public/private institution, small/large)

## Other factors:

- 2003-2008 was a competitive hiring season (may have larger startup packages as a result)
- 2008 Crash and budget freeze at the state level
- American Recovery and Reinvestment Act (2009) with increased funding levels
- 2012 slowdown in research funding (may need to compare to NSF/NIH/USDA/DOD/DOE/Ames Lab funding levels)


# Analysis of Individual Datasets

## Office of the Vice President for Research Data

```{r OVPRdata, cache=F}
source("Code/CleanStartupFundingData.R")
```

### Total Startup Package Cost
```{r TotalCost, echo=F, fig.width=9, fig.height=5, fig.cap="Total Startup Package Cost, by College"}
qplot(Year, Total.Cost, color=Dept1, data=hires, geom="jitter", shape=I(1)) +
scale_y_log10() +
scale_color_discrete(guide="none") +
ggtitle("Total Startup Package Cost")  +
theme_bw() +
facet_wrap(~College, ncol=4)
```

### Computing Expenses
```{r ComputingExpenseProp, echo=F, fig.width=8, fig.height=5, fig.cap=c("Proportion of startup $ allocated for computers", "Amount allocated for computers")}
qplot(Year, Amount/Total.Cost, color=Dept1, data=subset(startup.package, Item=="Computer.peripherals"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
ggtitle("Proportion of package allocated to computer equip.")  +
theme_bw() +
facet_wrap(~College, ncol=4)

qplot(Year, Amount, color=Dept1, data=subset(startup.package, Item=="Computer.peripherals"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
ggtitle("Amount of startup funds allocated for computer equip.")  +
  scale_y_sqrt(breaks=c(0, 1000, 5000, 10000, 100000), label=c("0", "$1000", "$2500", "$10K", "$100K")) +
ylab("Amount") + 
theme_bw() +
facet_wrap(~College, ncol=4, scales="free_y")
```

In Ag & Life Science, I suspect the computer allocation has decreased due to Moore's law (it's cheaper to get computers that can process genetic data now than it was in 2005). Engineering allocations seem to be somewhat department-related (clustering of green and blue values, in particular). The business school seems remarkably standardized - the amount decreased in 2011-2013, but otherwise has been at approximately the same level (with extremely low variance). 

### Lab Space/Equipment Expenses
```{r LabExpenseProp, echo=F, fig.width=8, fig.height=5, fig.cap=c("Proportion of startup $ allocated for lab space and equipment.", "Amount allocated for lab space and equpment")}
qplot(Year, Amount/Total.Cost, color=Dept1, data=subset(startup.package, Item=="Lab.space.equipment"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
ggtitle("Proportion of package allocated to lab space/equip.")  +
theme_bw() +
facet_wrap(~College, ncol=4)

qplot(Year, Amount, color=Dept1, data=subset(startup.package, Item=="Lab.space.equipment"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
ggtitle("Amount of startup funds allocated for lab space/equip.")  +
theme_bw() +
facet_wrap(~College, ncol=4, scales="free_y")
```

Lab space and lab equipment are obviously only relevant for some colleges. The proportion and raw amount of funding for lab space and equipment in LAS has decreased, while the amount of funding in engineering and human sciences has increased (though the proportion of the funding package has stayed reasonably consistent).  

### Graduate Assistant Expenses
```{r GradExpenseProp, echo=F, fig.width=8, fig.height=5, fig.cap=c("Proportion of startup $ allocated for graduate assistant support.", "Amount allocated for graduate assistant support")}
qplot(Year, Amount/Total.Cost, color=Dept1, data=subset(startup.package, Item=="Graduate.assistants"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
  geom_smooth(aes(x=Year, y=Amount/Total.Cost), color=I("black"), data=subset(startup.package, Item=="Graduate.assistants")) + 
ggtitle("Proportion of package allocated for graduate assistants")  +
theme_bw() +
facet_wrap(~College, ncol=4)

qplot(Year, Amount, color=Dept1, data=subset(startup.package, Item=="Graduate.assistants"), geom="jitter", shape=I(1)) +
  geom_smooth(aes(x=Year, y=Amount), color=I("black"), data=subset(startup.package, Item=="Graduate.assistants")) + 
scale_color_discrete(guide="none") +
ggtitle("Amount of startup funds allocated for graduate assistants")  +
theme_bw() +
facet_wrap(~College, ncol=4, scales="free_y")
```

The recession seems to have hit graduate student support fairly hard (relative to other expenses). Looking at the gross amount of funding allocated for graduate students, we see that startup packages in engineering and human sciences include more support for graduate students than in the past (this is particularly dramatic in human sciences, though the amount of funding is still overall lower than in engineering). In the other colleges, the amount of support for graduate students has stayed relatively consistent over the past 10 years. 

### Summer Support
```{r SummerExpenseProp, echo=F, fig.width=8, fig.height=5, fig.cap="Proportion of startup $ allocated for summer support."}
qplot(Year, Amount/Total.Cost, color=Dept1, data=subset(startup.package, Item=="Summer.support"), geom="jitter", shape=I(1)) +
  geom_smooth(aes(x=Year, y=Amount/Total.Cost), color=I("black"), data=subset(startup.package, Item=="Summer.support")) + 
scale_color_discrete(guide="none") +
ggtitle("Proportion of package allocated for summer support")  +
theme_bw() +
facet_wrap(~College, ncol=4)

qplot(Year, Amount, color=Dept1, data=subset(startup.package, Item=="Summer.support"), geom="jitter", shape=I(1)) +
  geom_smooth(aes(x=Year, y=Amount), color=I("black"), data=subset(startup.package, Item=="Summer.support")) + 
scale_color_discrete(guide="none") +
ggtitle("Amount of startup funds allocated for summer support")  +
theme_bw() +
facet_wrap(~College, ncol=4, scales="free_y")
```

Summer funding seems to be fairly common in some areas (business, some of LAS) and almost unheard of in others (design, vet med). 

### Research Support
```{r ResearchExpenseProp, echo=F, fig.width=8, fig.height=5, fig.cap=c("Proportion of startup $ allocated for research support.", "Amount of startup $ allocated for research support.")}
qplot(Year, Amount/Total.Cost, color=Dept1, data=subset(startup.package, Item=="Research.support"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
ggtitle("Proportion of package allocated for research support")  +
theme_bw() +
facet_wrap(~College, ncol=4)

qplot(Year, Amount, color=Dept1, data=subset(startup.package, Item=="Research.support"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
ggtitle("Amount of funding allocated for research support")  +
theme_bw() +
facet_wrap(~College, ncol=4, scales="free_y")
```

### Moving Expenses
```{r MovingExpenseProp, echo=F, fig.width=8, fig.height=5, fig.cap=c("Proportion of startup $ allocated for moving expenses.", "Amount allocated to moving expenses")}
qplot(Year, Amount/Total.Cost, color=Dept1, data=subset(startup.package, Item=="Moving.expenses"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
ggtitle("Proportion of package allocated for moving expenses")  +
theme_bw() +
facet_wrap(~College, ncol=4)

qplot(Year, Amount, color=Dept1, data=subset(startup.package, Item=="Moving.expenses"), geom="jitter", shape=I(1)) +
scale_color_discrete(guide="none") +
ggtitle("Amount allocated for moving expenses")  +
theme_bw() +
facet_wrap(~College, ncol=4)
```

Moving expenses amounts seem to be reasonably consistent across colleges. The business college seems to once again have a standard package that may change year to year with occasional negotiation. The same may be true of the vet med college. 

## Office of Sponsored Programs Administration Data

Datasets from OSPA contain information on proposals and awards from 2005-2010 and 2010-2015 (4 total databases). 


```{r OSPAdata, cache=F}
source("Code/CleanAwardsData.R")
source("Code/CleanProposalsData.R")
```

The following sections are intended to explore some of the limitations of the Proposal and Award datasets. They are not essential for understanding the subsequent analysis. 
### Proposals

```{r ProposalExploration}
prop$Source2 <- factor(prop$Source, labels=c("FY06-FY10", "FY11-FY16"), levels=c("Proposals FY06 to FY10.csv", "KC Investigator Proposal ALL 06072015.csv"))
```

Some categories of proposals occur in FY06-FY10 but not in FY11-FY16. 
```{r ProposalActivity, fig.width=8, fig.height=4, dpi=300}
qplot(Activity.Type, data=prop, color=I("black"), fill=I("grey")) + 
  facet_wrap(~Source2, ncol=2) + 
  xlab("Activity Type") + ylab("Proposal Count") + ggtitle("Proposal Activities") + 
  theme_bw()  + theme(legend.position="bottom", axis.text.x=element_text(angle=45, hjust=1))
```

We do not have proposal type data for FY06-FY10. This would be useful to have, but does not seem to be present in the database. 
```{r ProposalTypes, fig.width=8, fig.height=4, dpi=300}
qplot(Proposal.Type, data=prop, color=I("black"), fill=I("grey")) + 
  facet_wrap(~Source2, ncol=2) + 
  xlab("Proposal Type") + ylab("Proposal Count") + ggtitle("Proposal Type") + 
  theme_bw()  + theme(legend.position="bottom", axis.text.x=element_text(angle=45, hjust=1))
```

Similarly, we don't have information on the funding type for FY11-FY16. It may be useful to exclude Master Agreements, etc. from the data if no similar category exists in FY11-FY16. 

```{r FundingTypes, fig.width=8, fig.height=4, dpi=300}
qplot(Grant.Type, data=prop, color=I("black"), fill=I("grey")) + 
  facet_wrap(~Source2, ncol=2) + 
  xlab("Funding Type") + ylab("Proposal Count") + ggtitle("Funding Type") + 
  theme_bw()  + theme(legend.position="bottom", axis.text.x=element_text(angle=45, hjust=1))
```

Other differences between the two proposal datasets are unsurprising, such as that there are no pending proposals from FY06-FY10. 
```{r ProposalStatus, fig.width=8, fig.height=4, dpi=300}
qplot(Proposal.Status, fill=Source2, position="stack", data=prop) +
  scale_fill_discrete("Data Source") + 
  xlab("Proposal Status") + ylab("Proposal Count") + ggtitle("Proposal Status") + 
  theme_bw() + theme(legend.position="bottom")
```

Proposals are roughly evenly distributed over time, with a slight spike that corresponds to April - July 2009 (presumably, the American Recovery and Reinvestment Act proposals). 
```{r ProposalsOverTime, fig.width=8, fig.height=4, dpi=300}
prop.unique <- prop %>% group_by(Proposal.Number, Submit.Date, Source2) %>% summarise(ct=length(Proposal.Number))

ggplot() + 
  geom_histogram(aes(x=floor_date(Submit.Date, "month"), fill=Source2), color="black", position="stack", data=prop.unique) + 
  xlab("Submission Date") + ylab("Count") + ggtitle("Number of Proposals Submitted") + 
  theme_bw() + theme(legend.position="bottom")

rm(prop.unique)
```

Next, we consider the timeline for each proposal. Proposals have a submission date, a start date (presumably, when funding would begin), and an end date (when funding would cease). 
```{r ProposalTimeline, fig.width=8, fig.height=4, dpi=300}
prop.span <- melt(prop, id.vars = c("Proposal.Number", "Source2", "Proposal.Title"), measure.vars=c("Start.Date", "End.Date", "Submit.Date"), value.name = "Date", variable.name = "Proposal.Span")
prop.span$Proposal.Span <- factor(prop.span$Proposal.Span, levels=c("Submit.Date", "Start.Date", "End.Date"))

ggplot(data=prop.span) + 
  geom_histogram(aes(x=floor_date(Date, "quarter"), fill=Source2), 
               position="stack", adjust=1.25, trim=T, binwidth=15*60*24*365) + 
  facet_grid(Proposal.Span~.) + 
  theme_bw() + 
  scale_x_datetime(limits=c(mdy("07012001"), mdy("07012026")), breaks=date_breaks("5 years")) + 
  scale_fill_discrete("Data Source") + xlab("Date") + ylab("Density") + ggtitle("Proposal Timeline") + 
  theme(legend.position="bottom") 
```
There is clearly some periodicity in the funding cycle (end dates, in particular) likely caused by differences between the academic year, government fiscal year, and calendar year. 

Examining this from a slightly different perspective, we consider the difference between proposal submission dates and the start and end dates in those proposals. 
```{r ProposalStartEnd, fig.width=8, fig.height=4, dpi=300}
prop.span <- melt(prop, id.vars = c("Proposal.Number", "Source2", "Proposal.Title", "Submit.Date"), measure.vars=c("Start.Date", "End.Date"), value.name = "Date", variable.name = "Proposal.Span")
prop.span$Proposal.Span <- factor(prop.span$Proposal.Span, levels=c("Start.Date", "End.Date"))
prop.span$FundingLag <- with(prop.span, difftime(Date, Submit.Date, units="days")) 
prop.span$FundingLag <- as.numeric(prop.span$FundingLag)/(365.25) # convert to years

ggplot(data=prop.span) + 
  geom_histogram(aes(x=FundingLag), fill="grey", color="black", binwidth=.25, inherit.aes=F) + 
  facet_wrap(~Proposal.Span, scales="free") + 
  theme_bw() + 
  scale_x_continuous(limits=c(-1, 10), breaks=0:9) + 
  xlab("Years from Proposal Submission Date") + ylab("Count") + ggtitle("Proposal Duration") + 
  theme(legend.position="bottom") 

```
`r round(sum(subset(prop.span, Proposal.Span=="Start.Date")$FundingLag<0, na.rm=T)/sum(!is.na(subset(prop.span, Proposal.Span=="Start.Date")$FundingLag), na.rm=T)*100)`% of proposals appear to start before they are submitted, and `r round(sum(subset(prop.span, Proposal.Span=="End.Date")$FundingLag<=0, na.rm=T)/sum(!is.na(subset(prop.span, Proposal.Span=="Start.Date")$FundingLag), na.rm=T)*100, 2)`% also end before they are submitted. 

Looking at the funding duration directly, we see that proposals tend to provide funding over 1-5 years, though very few do extend 10 or more years into the future. A few proposals extend 100 years into the future; this situation occurs when an amount of money is donated for some purpose and can be used at any point. 
```{r ProposalDuration, fig.width=8, fig.height=4, dpi=300}
ggplot(data=prop) + 
  geom_histogram(aes(x=as.numeric(difftime(End.Date, Start.Date, units="days")/365.25)), 
                 binwidth=.25, color="black", fill="grey", right=T) + 
  scale_x_continuous("Proposal Duration", limits=c(0, 10), breaks=0:10) + 
  ylab("Count") + ggtitle("Duration of Proposed Funding") + theme_bw() + 
  theme(legend.position="bottom") 
```

```{r ProposalCleanUp}
rm(prop.span, prop.unique)
```

### Awards

```{r AwardExploration}
awards$Source2 <- factor(awards$Source, labels=c("FY06-FY10", "FY11-FY16"), levels=c("Awards FY06 to FY10.csv", "KC Investigator Award ALL 06072015.csv"))
```

Some award activity categories were created for FY11-16: Student Services, Institutional Support, and Academic Support. Other categories have been combined, for instance, the "Dept/Admin Support" category in FY06-FY10 has been combined into the Public Service category, but the overall funding level has declined significantly. 
```{r AwardActivity, fig.width=6, fig.height=8, out.width="80%"}
qplot(Activity.Type, data=awards, color=I("black"), fill=I("grey")) + 
  facet_wrap(~Source2, ncol=2) + coord_flip() +
  xlab("Activity Type") + ylab("Award Count") + ggtitle("Funded Award Activities") + 
  theme_bw()  + theme(legend.position="bottom")
```
Similarly, some award types that were not tracked for FY06-FY10 are tracked in FY11-FY16. 
```{r AwardType, fig.width=8, fig.height=8, out.width="100%"}
qplot(Award.Type, data=subset(awards, !is.na(Award.Type)), color=I("black"), fill=I("grey")) + 
  facet_wrap(~Source2, ncol=2) +  coord_flip() +
  xlab("Award Type") + ylab("Award Count") + ggtitle("Award Type") + 
  theme_bw()  + theme(legend.position="bottom")
```
Considering the timeline of awards, we find some interesting data artifacts:
```{r AwardSpan, fig.width=6, fig.height=6}
award.span <- melt(awards, id.vars = c("Award.Number", "Source2", "Award.Title"), measure.vars=c("Start.Date", "End.Date"), value.name = "Date", variable.name = "Award.Span")
award.span$Award.Span <- factor(award.span$Award.Span, levels=c("Start.Date", "End.Date"))

ggplot(data=award.span) + 
  geom_histogram(aes(x=floor_date(Date, "quarter"), fill=Source2), 
               position="stack", adjust=1.25, trim=T, binwidth=15*60*24*365) + 
  facet_grid(Award.Span~.) + 
  theme_bw() + 
  scale_x_datetime(limits=c(mdy("07012001"), mdy("07012026")), breaks=date_breaks("5 years")) + 
  scale_fill_discrete("Data Source") + xlab("Date") + ylab("Count") + ggtitle("Award Timeline")

rm(award.span)
```
Some awards from FY11-16 started in FY05-FY10; this is likely because "Start.Date" and "End.Date" variables have slightly different meanings in the two datasets - in FY05-FY10, these dates indicate payement dates, where in FY11-FY16, these dates are based on the proposal itself. 
```{r AwardLength, fig.width=6, fig.height=4}
ggplot(data=awards) + 
  geom_histogram(aes(x=as.numeric(difftime(End.Date, Start.Date, units="days"))/365.25, fill=Source2), 
                 color="black", binwidth=.25) + 
  scale_x_continuous("Years of Funding", limits=c(-1, 10), breaks=0:9) + 
  scale_fill_discrete("Data Source") + 
  xlab("Date") + ylab("Count") + ggtitle("Funding Span") + 
  theme(legend.position="bottom") + theme_bw()
```
The length of funding also differs between the two datasets as a result of the difference in start date calculations. 

Award status differs between the two files as well; this is to be expected (more Active awards should be in the FY11-FY16 data, for instance). "Final" and "Executed" awards are present in FY11-FY16; I am currently tracking down what those statuses imply. 
```{r AwardStatus, fig.width=6, fig.height=4}
ggplot(data=awards) +  
  geom_histogram(aes(x=Award.Status), color=I("black"), fill=I("grey")) + 
  facet_wrap(~Source2) + coord_flip() + 
  xlab("Award Status") + ylab("Count") + ggtitle("Award Status") + 
  theme_bw() + theme(legend.position="bottom")
```

Finally, we explore the amount of grant funding by year. Grants spanning many years are allocated to the midpoint of the funding range. 
```{r AwardAmounts, fig.width=6, fig.height=4}
ggplot(data=awards) + 
  geom_histogram(aes(x=rowMeans(cbind(decimal_date(Start.Date), decimal_date(End.Date))), weight=Award.Amount), 
                 color="black", fill="grey") + 
  scale_fill_discrete("Data Source") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 1e3, 1e5, 1e7, 1e9, 1e11)) +
  # scale_x_datetime(limits=mdy("01-01-2004", "01-01-2016")) + 
  xlab("Date") + ylab("Amount of Funding ($)") + ggtitle("Total Award Funding Over Time")+ 
  theme_bw() + theme(legend.position="bottom")
```

# Analysis of Merged Data
```{r MergeDatasetsSetup, cache=F}
received.money <- awards %>% 
  group_by(Investigator) %>% 
  summarize(grant.received = sum(Award.Amount), 
            n.awards = length(unique(Award.Number)))
received.money$grant.received[is.na(received.money$grant.received)] <- 0

submitted.proposals <- prop %>% 
  group_by(Investigator) %>% 
  summarize(total.proposal.money = sum(Proposal.Amount), 
            n.proposals = length(unique(Proposal.Number)), 
            prop.fund.pct = mean(Proposal.Status=="Funded"))
submitted.proposals$total.proposal.money[is.na(submitted.proposals$total.proposal.money)] <- 0

tmp <- merge(hires, received.money, by.x="Name", by.y="Investigator", all.x=T, all.y=F)
tmp <- merge(tmp, submitted.proposals, by.x="Name", by.y="Investigator", all.x=T, all.y=F)
tmp$grant.received[is.na(tmp$grant.received)] <- 0
tmp$total.proposal.money[is.na(tmp$total.proposal.money)] <- 0

tmp$ProfRankFac <- tmp$ProfRank %>% 
  str_replace("(Adjunct/Lecturer)|(Affiliate Prof)|(Clinician)", "Other") %>%
  str_replace("Distg ", "") %>%
  factor(levels=c("Asst Prof", "Assoc Prof", "Prof", "Other"), labels=c("Assistant", "Associate", "Professor", "Other"))

tmp$CollegeFac <- tmp$College %>% factor(labels=c("AGLS", "Bus", "Des", "Engr", "Hum Sci", "LAS", "Vet Med"))

tmp$YearsAtISU <- 2015 - tmp$Year

tmp$YearsAtISUFac <- cut_number(tmp$YearsAtISU, n=4)

# Quartiles for startup funding, by college
startup.quantiles <- tmp %>% group_by(CollegeFac) %>% summarize(Q1=quantile(Total.Cost, .25, type=8), Q2=quantile(Total.Cost, .5, type=8), Q3=quantile(Total.Cost, .75, type=8), Q4=quantile(Total.Cost, 1, type=8)) %>% melt(id.vars=1, measure.vars=2:ncol(.), variable.name="Quantile", value.name="Total.Cost")

# Rank individual faculty startup packages by the quartile of their respective college. 
tmp <- tmp %>% group_by(CollegeFac) %>% mutate(TotalCostFac = as.numeric(cut(Total.Cost, breaks=quantile(Total.Cost, probs=0:4/4))))
tmp$TotalCostFac[is.na(tmp$TotalCostFac)] <- 1
tmp$TotalCostFac <- factor(tmp$TotalCostFac, levels=1:4, labels=c("Startup $: Q1", "Startup $: Q2", "Startup $: Q3", "Startup $: Q4"))
```

We'll begin by looking at the timeline - how many years at ISU are necessary before grant applications are successful? We split this by college and faculty rank (as we'd expect that full professors who are hired should be able to command grant money sooner than new faculty). Subsequent graphs show data from hired professors (i.e. not adjuncts, affiliates, lecturers, or clinicians). 

```{r YearsAtISUGrants, fig.width=6, fig.height=8, dpi=300}
ggplot(aes(x=YearsAtISU, y=grant.received, color=CollegeFac, shape=CollegeFac), data=subset(tmp, ProfRankFac!="Other" )) +
  geom_jitter(size=4, alpha=.5) + 
  # geom_smooth(se=F, adjust=2) + 
  scale_shape_manual(values=c('A', 'B', 'D', 'E', 'H', 'L', 'V'), guide=F) +
  scale_color_discrete(guide=F) + 
  # guides(shape=guide_legend(ncol=7), color=guide_legend(ncol=7)) + 
  facet_grid(CollegeFac~ProfRankFac, scales="free") + 
  xlab("Years from Hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 1e3, 1e5, 1e7))
```
The most noticeable difference between colleges is that in engineering, assistant professors get grants about five years after they are hired, and it is very rare for professors at that stage in their careers not to get grant funding. This trend is present (though less pronounced) in Ag & Life Sciences and Human Sciences as well, though some assistant professors in those colleges seem to get funding much earlier in their careers (perhaps because of large grants given to groups of professors). In Liberal Arts and Sciences, grant funding does seem to increase with experience for some hires, but perhaps because LAS includes both arts (which are less grant-reliant) and sciences, this trend is less pronounced than in other colleges. 

In order to examine the effect of startup funding on grant receipts over a career of variable duration, we will examine the distribution of startup funding by college, categorizing startup costs by the quartile (calculated for the hire's college). Below, vertical lines mark these quantiles

```{r TotalCostQuartiles, fig.width=6, fig.height=6, dpi=300}
ggplot(aes(x=Total.Cost, fill=CollegeFac), data=tmp) + 
  geom_density(aes(y=..density..), origin=0, color="black", trim=T) +
  geom_vline(aes(xintercept=Total.Cost), data=startup.quantiles) + 
  scale_fill_discrete(guide=F) + 
  scale_x_continuous(trans='sqrt', breaks=c(1000, 25000, 50000, 100000, 250000, 500000, 1e6, 2e6), labels=c("1K", "25K", "50K", "100K", "250K", "500K", "1M", "2M"), limits=c(0, 2e6)) + 
  facet_grid(CollegeFac~.) + 
  ggtitle("Distribution of Startup Costs by College") +
  xlab("Startup Package Cost") + ylab("Count") + 
  # guides(fill=guide_legend(ncol=7)) + 
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical")
```

Using these quantile calculations, we then can examine total grants received as explained by years since hired. 

```{r YearsTotalCostGrantsByCollege, fig.width=8, fig.height=6, dpi=300}
ggplot(aes(x=YearsAtISU, y=grant.received, shape=TotalCostFac, color=TotalCostFac), data=subset(tmp, ProfRankFac!="Other" )) +
  geom_jitter(size=3) + 
  geom_smooth(method="lm", span=.5, se=F, fullrange=F, aes(x=YearsAtISU, y=grant.received)) + 
  scale_shape_manual("Startup Funding Quantile\n(by college)", values=as.character(1:4), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  scale_color_manual("Startup Funding Quantile\n(by college)", values=c("purple", "blue", "darkgreen", "orange"), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  guides(shape=guide_legend(ncol=7, override.aes=list(size=4)), color=guide_legend(ncol=7)) + 
  facet_wrap(~CollegeFac, ncol=4) + 
  xlab("Years since hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 10, 1e3, 1e5, 1e7), limits=c(0, 2e7)) +
  scale_x_continuous(breaks=c(0, 5, 10))
```

It is important to note several caveats at this point: first, hires are not separated out by faculty rank or position, so hires whose primary responsibilities include administrative work may command large startup packages but bring in relatively little grant funding. Additionally, different colleges have different funding structures: LAS, for instance, may need to provide lab startup funding for science based departments, but would not have to provide this funding for new hires in English or History. Finally, the x-axis shows years since hire, which does not necessarily translate to years at ISU (faculty hired in 2005 may have left in 2011 after receiving tenure, for example). 

Linear regression lines are provided here as (extremely) rough approximations; it may be useful to examine the right-most endpoint (rather than the entire line) as a prediction of total grant money received after 10 years at ISU. 

With these caveats in mind, 

* Startup funding in LAS is correlated with later grant funding; this is likely explained by departmental startup funding (and grant funding) norms. 
* Startup funding in engineering is largely not predictive of grant receipts; after 10 years, hires with small startup packages receive approximately the same grant funding as hires with large startup packages. 
* Startup funding in Human Sciences is correlated with later grant funding- this may again be a departmental norm situation (food scientists may require lab space and compete for NSF/NIH grants, where professors in the hospitality management department require fewer financial resources when hired and receive fewer grants.)
* Grants are relatively rare in the business college.   

Examining the LAS results in more detail, we see that departmental startup packages largely fall in the same quantiles. In Chemistry, Physics, BBMB, EEOB, Computer Science, Statistics, Economics, and Math, the career trajectory of grant funding suggests that the large startup packages are worthwhile investments; these disciplines are also largely in the top two quartiles for startup funding. Psychology is more of a mixed bag; many psychologists received large startup packages but have not received significant grant funding. Disciplines with more economical startup packages are also less likely to have faculty receiving large grants; this is likely due to discipline norms, rather than faculty quality. 
```{r YearsTotalCostGrantsLAS, fig.width=6, fig.height=6, dpi=300}
ggplot(aes(x=YearsAtISU, y=grant.received, shape=TotalCostFac, color=TotalCostFac), data=subset(tmp, CollegeFac=="LAS" & ProfRankFac!="Other" )) +
  geom_jitter(size=3) + 
  scale_shape_manual("Startup Funding Quantile\n(by college)", values=as.character(1:4), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  scale_color_manual("Startup Funding Quantile\n(by college)", values=c("purple", "blue", "darkgreen", "orange"), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  guides(shape=guide_legend(ncol=7, override.aes=list(size=4)), color=guide_legend(ncol=7)) + 
  facet_wrap(~Dept1) + 
  xlab("Years since hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 10, 1e3, 1e5, 1e7), limits=c(0, 2e7)) + 
  scale_x_continuous(breaks=c(0, 5, 10))
```

By comparison, the College of Engineering is fairly consistent; some departments have more startup funding (MSE, CBE), but overall, grant receipts are largely similar (though there is not sufficient data for Ag & Biosystems Engineering to determine whether that department receives grants at the same rate as other departments). Grant funding may increase slightly over the course of a career (there are increases in AerE, MSE, and ME that are fairly consistent). After 2 years, most hires will have received at least $100,000 in grant funding, and many hires will have received at least one million in cumulative grants after 5-6 years. Startup funding does not seem to affect these trends in a significant way, except that more recent hires seem more likely to receive large startup packages, and are less likely to have received grant money at this point in their careers.  
```{r YearsTotalCostGrantEngr, fig.width=6, fig.height=6, dpi=300}
ggplot(aes(x=YearsAtISU, y=grant.received, shape=TotalCostFac, color=TotalCostFac), data=subset(tmp, CollegeFac=="Engr" & ProfRankFac!="Other" )) +
  geom_jitter(size=3, position=position_jitter(width=.5, height=0)) + 
  scale_shape_manual("Startup Funding Quantile\n(by college)", values=as.character(1:4), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  scale_color_manual("Startup Funding Quantile\n(by college)", values=c("purple", "blue", "darkgreen", "orange"), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  guides(shape=guide_legend(ncol=7, override.aes=list(size=4)), color=guide_legend(ncol=7)) + 
  facet_wrap(~Dept1) + 
  xlab("Years since hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 10, 1e3, 1e5, 1e7), limits=c(0, 2e7)) + 
  scale_x_continuous(breaks=c(0, 5, 10))
```

Examining the College of Agriculture & Life Sciences, we find again that different departments have different startup funding resources, but that within a department, startup funding does not seem to greatly predict later grant receipts. 
```{r YearsTotalCostGrantAGLS, fig.width=6, fig.height=6, dpi=300}
ggplot(aes(x=YearsAtISU, y=grant.received, shape=TotalCostFac, color=TotalCostFac), data=subset(tmp, CollegeFac=="AGLS" & ProfRankFac!="Other" & Dept1!="Stat")) +
  geom_jitter(size=3, position=position_jitter(width=.5, height=0)) + 
  scale_shape_manual("Startup Funding Quantile\n(by college)", values=as.character(1:4), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  scale_color_manual("Startup Funding Quantile\n(by college)", values=c("purple", "blue", "darkgreen", "orange"), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  guides(shape=guide_legend(ncol=7, override.aes=list(size=4)), color=guide_legend(ncol=7)) + 
  facet_wrap(~Dept1) + 
  xlab("Years since hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 10, 1e3, 1e5, 1e7), limits=c(0, 2e7)) + 
  scale_x_continuous(breaks=c(0, 5, 10))
```

Examining the College of Human Sciences, we find again that different departments have different startup funding resources; Food Science and Human Nutrition in particular tends to have more startup funding than other departments, while the School of Education has a uniquely time-dependent startup funding allocation - hires from FY06-FY10 are typically in the first quartile of startup package funding, while hires from FY11-FY13 are typically in the second quadrant, and hires from FY13-FY15 are typically in the third quadrant. In the school of education, at least, startup funding (relative to others hired at approximately the same time) seems to be associated with a higher probability of grant receipts, at least in part because those hired as Associate and Full professors (circled values in the graph) can command higher startup packages and seem somewhat more likely to receive grant funding. 
```{r YearsTotalCostGrantHumSci, fig.width=6, fig.height=6, dpi=300}
tmp$YearsAtISUjit <- jitter(tmp$YearsAtISU)
ggplot(aes(x=YearsAtISUjit, y=grant.received), data=subset(tmp, CollegeFac=="Hum Sci" & ProfRankFac!="Other")) +
  geom_point(aes(shape=TotalCostFac, color=TotalCostFac), size=3) +
  geom_point(aes(color=TotalCostFac), data=subset(tmp, CollegeFac=="Hum Sci" & !ProfRankFac%in%c("Assistant", "Other")), size=5, shape=1, show_guide=F) + 
  scale_shape_manual("Startup Funding Quantile\n(by college)", values=as.character(1:4), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  scale_color_manual("Startup Funding Quantile\n(by college)", values=c("purple", "blue", "darkgreen", "orange"), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  guides(shape=guide_legend(ncol=7, override.aes=list(size=4)), color=guide_legend(ncol=7)) + 
  facet_wrap(~Dept1) + 
  xlab("Years since hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 10, 1e3, 1e5, 1e7), limits=c(0, 2e7)) + 
  scale_x_continuous(breaks=c(0, 5, 10))
tmp <- tmp[,-which(names(tmp)=="YearsAtISUjit")]
```

Examining the College of Veterinary Medicine, we find great differences in grant receipts between departments; grants are almost unheard of in Veterinary Pathology, but are reasonably common in Veterinary Diagnostic and Production Animal Medicine. In this college, startup funding does seem to somewhat correlate with grant receipts; the most expensive startup packages typically receive grant funding, particularly in the BMS, VCS, and VDPAM departments. 
```{r YearsTotalCostGrantVetMed, fig.width=6, fig.height=6, dpi=300}
ggplot(aes(x=YearsAtISU, y=grant.received, shape=TotalCostFac, color=TotalCostFac), data=subset(tmp, CollegeFac=="Vet Med" & ProfRankFac!="Other")) +
  geom_jitter(size=3, position=position_jitter(width=.5, height=0)) + 
  scale_shape_manual("Startup Funding Quantile\n(by college)", values=as.character(1:4), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  scale_color_manual("Startup Funding Quantile\n(by college)", values=c("purple", "blue", "darkgreen", "orange"), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  guides(shape=guide_legend(ncol=7, override.aes=list(size=4)), color=guide_legend(ncol=7)) + 
  facet_wrap(~Dept1) + 
  xlab("Years since hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 10, 1e3, 1e5, 1e7), limits=c(0, 2e7)) + 
  scale_x_continuous(breaks=c(0, 5, 10))
```

Examining the College of Business, we find that grant funding is so rare in business that it would be nearly impossible to draw meaningful conclusions about the relationship between startup funding and grants. Additionally complicating the issue, funding for startup packages seems to be higher for hires in FY11-FY16 than in FY06-FY10. 
```{r YearsTotalCostGrantBus, fig.width=6, fig.height=6, dpi=300}
ggplot(aes(x=YearsAtISU, y=grant.received, shape=TotalCostFac, color=TotalCostFac), data=subset(tmp, CollegeFac=="Bus" & ProfRankFac!="Other")) +
  geom_jitter(size=3, position=position_jitter(width=.5, height=0)) + 
  scale_shape_manual("Startup Funding Quantile\n(by college)", values=as.character(1:4), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  scale_color_manual("Startup Funding Quantile\n(by college)", values=c("purple", "blue", "darkgreen", "orange"), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  guides(shape=guide_legend(ncol=7, override.aes=list(size=4)), color=guide_legend(ncol=7)) + 
  facet_wrap(~Dept1) + 
  xlab("Years since hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 10, 1e3, 1e5, 1e7), limits=c(0, 2e7)) + 
  scale_x_continuous(breaks=c(0, 5, 10))
```


Examining the College of Design, we find again that startup costs do not seem to significantly influence later grant receipts once we account for department and time since hiring. 
```{r YearsTotalCostGrantDes, fig.width=6, fig.height=6, dpi=300}
ggplot(aes(x=YearsAtISU, y=grant.received, shape=TotalCostFac, color=TotalCostFac), data=subset(tmp, CollegeFac=="Des" & ProfRankFac!="Other")) +
  geom_jitter(size=3, position=position_jitter(width=.5, height=0)) + 
  scale_shape_manual("Startup Funding Quantile\n(by college)", values=as.character(1:4), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  scale_color_manual("Startup Funding Quantile\n(by college)", values=c("purple", "blue", "darkgreen", "orange"), labels=c("Q1", "Q2", "Q3", "Q4")) + 
  guides(shape=guide_legend(ncol=7, override.aes=list(size=4)), color=guide_legend(ncol=7)) + 
  facet_wrap(~Dept1) + 
  xlab("Years since hire") + ylab("Total Grant $ Received") + 
  ggtitle("Grant receipts based on hire date") +
  theme_bw() + theme(legend.position="bottom", legend.direction="vertical") + 
  scale_y_continuous(trans="log_one", breaks=c(0, 10, 1e3, 1e5, 1e7), limits=c(0, 2e7)) + 
  scale_x_continuous(breaks=c(0, 5, 10))
```